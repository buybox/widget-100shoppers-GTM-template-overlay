___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "100shoppers Where To Buy Widget Script",
  "brand": {
    "id": "brand_dummy",
    "displayName": "100shoppers",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "This adds 100shoppers Where To Buy widget script on your site.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "bb-type",
    "displayName": "Widget type",
    "selectItems": [
      {
        "value": "overlay",
        "displayValue": "overlay"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "overlay"
  },
  {
    "type": "TEXT",
    "name": "id",
    "displayName": "Document element ID",
    "simpleValueType": true,
    "help": "Document element ID that will be used as target element to show widget. If not provided floating button will be added to page."
  },
  {
    "type": "TEXT",
    "name": "bb-id",
    "displayName": "Widget configuration ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "hasVariants",
    "checkboxText": "Display multiple product variants?",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "bb-number",
    "displayName": "Product EAN",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "hasVariants",
        "paramValue": false,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "bb-var-default",
    "displayName": "Default variant",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "hasVariants",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "varNameOptions",
    "displayName": "Variant option names",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "bb-var-name-opt1",
        "displayName": "Option 1 name",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "bb-var-name-opt2",
        "displayName": "Option 2 name",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "bb-var-name-opt3",
        "displayName": "Option 3 name",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "bb-var-name-opt4",
        "displayName": "Option 4 name",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "bb-var-name-opt5",
        "displayName": "Option 5 name",
        "simpleValueType": true
      }
    ],
    "enablingConditions": [
      {
        "paramName": "hasVariants",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "variants",
    "displayName": "Variants",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-value-opt1",
          "displayName": "Option 1 value",
          "simpleValueType": true,
          "valueValidators": [
            {
              "type": "NON_EMPTY"
            }
          ]
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-value-opt2",
          "displayName": "Option 2 value",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-value-opt3",
          "displayName": "Option 3 value",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-value-opt4",
          "displayName": "Option 4 value",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-value-opt5",
          "displayName": "Option 5 value",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-number",
          "displayName": "Product EAN",
          "simpleValueType": true,
          "valueValidators": [
            {
              "type": "NON_EMPTY"
            }
          ]
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-name",
          "displayName": "Product name",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-info",
          "displayName": "Product description",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-image",
          "displayName": "Product image URL",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "bb-var-show-extra",
          "displayName": "Show product information",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": true,
              "displayValue": "Show"
            },
            {
              "value": false,
              "displayValue": "Do not show"
            }
          ],
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-price-top-limit",
          "displayName": "Maximum price",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-price-bottom-limit",
          "displayName": "Minimum price",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-abpar1",
          "displayName": "Additional user parameter (abpar1)",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-abpar2",
          "displayName": "Additional user parameter (abpar2)",
          "simpleValueType": true
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "TEXT",
          "name": "bb-var-abpar3",
          "displayName": "Additional user parameter (abpar3)",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "enablingConditions": [
      {
        "paramName": "hasVariants",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "additionalSettings",
    "displayName": "Additional settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "bb-name",
        "displayName": "Product name",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-info",
        "displayName": "Product description",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-image",
        "displayName": "Product image URL",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "bb-show-extra",
        "displayName": "Show product information",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": true,
            "displayValue": "Show"
          },
          {
            "value": false,
            "displayValue": "Do not show"
          }
        ],
        "simpleValueType": true,
        "notSetText": "",
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-price-top-limit",
        "displayName": "Maximum price",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-price-bottom-limit",
        "displayName": "Minimum price",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-abpar1",
        "displayName": "Additional user parameter (abpar1)",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-abpar2",
        "displayName": "Additional user parameter (abpar2)",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-abpar3",
        "displayName": "Additional user parameter (abpar3)",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "hasVariants",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "bb-show-if-empty",
        "displayName": "Element ID to display when widget has no offers",
        "simpleValueType": true,
        "enablingConditions": []
      },
      {
        "type": "TEXT",
        "name": "floating-btn-text",
        "displayName": "Floating button text",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "id",
            "paramValue": "",
            "type": "NOT_PRESENT"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const queryPermission = require('queryPermission');
const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const setInWindow = require('setInWindow');

const widgetUrl = 'https://widget.100shoppers.com/js/widget.min.js';

const initData = () => {
  let bbWidgets = copyFromWindow('bbWidgets');
  if (!bbWidgets) {
    bbWidgets = [];
  }
  const parsedData = {};
  for (let key in data) {
    if (key !== 'hasVariants' && key !== 'variants') {
      parsedData[key] = data[key];
    }
  }
  if (data.hasVariants) {
    data.variants.forEach((variant, variantIdx) => {
      for (let fieldKey in variant) {
        if (variant[fieldKey] !== undefined && variant[fieldKey] !== '') {
          const indexedKey = fieldKey.replace('bb-var-', 'bb-var' + (variantIdx + 1) + '-');
          parsedData[indexedKey] = variant[fieldKey];
        }
      }
    });
  }
  bbWidgets.push(parsedData);
  setInWindow('bbWidgets', bbWidgets, true);
};

const onFailure = () => {
  log('Unable to inject widget script!');
  data.gtmOnFailure();
};

const checkPermissions = () => {
  if (!queryPermission('inject_script', widgetUrl)) {
    log('Unable to inject widget script due to missing permissions!');
    return false;
  }
  if (!queryPermission('access_globals', 'readwrite', 'bbWidgets')) {
    log('Unable to access globals due to missing permissions!');
    return false;
  }
  return true;
};

if (checkPermissions()) {
  initData();
  injectScript(widgetUrl, undefined, onFailure, 'widget');
  data.gtmOnSuccess();
} else {
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://widget.100shoppers.com/js/widget.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "bbWidgets"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 28/07/2020, 06:05:26


